.PHONY: help install dev build clean rebuild typecheck validate test publish-patch publish-minor publish-major publish-beta publish-dry pack link unlink info prepare-github release-tag release-push release-github release-patch release-minor release-major

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
help:
	@echo "Available commands:"
	@echo ""
	@echo "Development:"
	@echo "  make install          - Install dependencies"
	@echo "  make dev              - Start development mode (watch)"
	@echo "  make build            - Build the package"
	@echo "  make clean            - Clean build output"
	@echo "  make rebuild          - Clean and rebuild"
	@echo "  make typecheck        - Run TypeScript type checking"
	@echo "  make validate         - Type check and build"
	@echo "  make test             - Test build"
	@echo ""
	@echo "Publishing:"
	@echo "  make publish-patch    - Publish patch version (1.0.0 â†’ 1.0.1)"
	@echo "  make publish-minor    - Publish minor version (1.0.0 â†’ 1.1.0)"
	@echo "  make publish-major    - Publish major version (1.0.0 â†’ 2.0.0)"
	@echo "  make publish-beta     - Publish beta version"
	@echo "  make publish-dry      - Dry run (test without publishing)"
	@echo ""
	@echo "Local Testing:"
	@echo "  make pack             - Create .tgz package"
	@echo "  make link             - Create local symlink"
	@echo "  make unlink           - Remove local symlink"
	@echo "  make info             - Show package info"
	@echo ""
	@echo "GitHub Release:"
	@echo "  make prepare-github   - Prepare dist for GitHub install"
	@echo "  make release-github   - Build, commit dist, and push"
	@echo "  make release-tag      - Create Git tag (usage: make release-tag TAG=v1.0.0)"
	@echo "  make release-push     - Push commits and tags"
	@echo ""
	@echo "Automated Release (All-in-one):"
	@echo "  make release-patch    - Auto release patch version (1.0.0 â†’ 1.0.1)"
	@echo "  make release-minor    - Auto release minor version (1.0.0 â†’ 1.1.0)"
	@echo "  make release-major    - Auto release major version (1.0.0 â†’ 2.0.0)"
	@echo ""

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
install:
	npm install

# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰
dev:
	npm run dev

# ãƒ“ãƒ«ãƒ‰
build:
	npm run build

# ã‚¯ãƒªãƒ¼ãƒ³
clean:
	npm run clean

# å†ãƒ“ãƒ«ãƒ‰
rebuild:
	npm run rebuild

# å‹ãƒã‚§ãƒƒã‚¯
typecheck:
	npm run typecheck

# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
validate:
	npm run validate

# ãƒ†ã‚¹ãƒˆ
test:
	npm run test:build

# ãƒ‘ãƒƒãƒå…¬é–‹
publish-patch:
	npm run publish:patch

# ãƒã‚¤ãƒŠãƒ¼å…¬é–‹
publish-minor:
	npm run publish:minor

# ãƒ¡ã‚¸ãƒ£ãƒ¼å…¬é–‹
publish-major:
	npm run publish:major

# ãƒ™ãƒ¼ã‚¿å…¬é–‹
publish-beta:
	npm run publish:beta

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³
publish-dry:
	npm run publish:dry

# ãƒ‘ãƒƒã‚¯
pack:
	npm run pack:local

# ãƒªãƒ³ã‚¯
link:
	npm run link:local

# ã‚¢ãƒ³ãƒªãƒ³ã‚¯
unlink:
	npm run unlink:local

# æƒ…å ±è¡¨ç¤º
info:
	npm run info

# GitHub ãƒªãƒªãƒ¼ã‚¹æº–å‚™
prepare-github:
	npm run prepare:github

# GitHub ãƒªãƒªãƒ¼ã‚¹ï¼ˆãƒ“ãƒ«ãƒ‰ + ã‚³ãƒŸãƒƒãƒˆ + ãƒ—ãƒƒã‚·ãƒ¥ï¼‰
release-github:
	npm run release:github

# ã‚¿ã‚°ä½œæˆ
release-tag:
	@if [ -z "$(TAG)" ]; then \
		echo "Error: TAG is required. Usage: make release-tag TAG=v1.0.0"; \
		exit 1; \
	fi
	git tag -a $(TAG) -m "Release $(TAG)"
	@echo "Tag $(TAG) created. Run 'make release-push' to push."

# ãƒ—ãƒƒã‚·ãƒ¥
release-push:
	npm run release:push

# è‡ªå‹•ãƒªãƒªãƒ¼ã‚¹: ãƒ‘ãƒƒãƒ (1.0.0 â†’ 1.0.1)
release-patch:
	@echo "ğŸš€ Starting automated patch release..."
	@echo ""
	@echo "Step 1/5: Running validation..."
	npm run validate
	@echo ""
	@echo "Step 2/5: Bumping patch version..."
	npm version patch
	@echo ""
	@echo "Step 3/5: Building package..."
	npm run build
	@echo ""
	@echo "Step 4/5: Committing dist files..."
	git add dist/
	git diff --staged --quiet || git commit -m "build: update dist files for $$(node -p "require('./package.json').version")"
	@echo ""
	@echo "Step 5/5: Pushing to GitHub..."
	git push --follow-tags
	@echo ""
	@echo "âœ… Release complete! GitHub Actions will create the release."
	@echo "Version: $$(node -p "require('./package.json').version")"

# è‡ªå‹•ãƒªãƒªãƒ¼ã‚¹: ãƒã‚¤ãƒŠãƒ¼ (1.0.0 â†’ 1.1.0)
release-minor:
	@echo "ğŸš€ Starting automated minor release..."
	@echo ""
	@echo "Step 1/5: Running validation..."
	npm run validate
	@echo ""
	@echo "Step 2/5: Bumping minor version..."
	npm version minor
	@echo ""
	@echo "Step 3/5: Building package..."
	npm run build
	@echo ""
	@echo "Step 4/5: Committing dist files..."
	git add dist/
	git diff --staged --quiet || git commit -m "build: update dist files for $$(node -p "require('./package.json').version")"
	@echo ""
	@echo "Step 5/5: Pushing to GitHub..."
	git push --follow-tags
	@echo ""
	@echo "âœ… Release complete! GitHub Actions will create the release."
	@echo "Version: $$(node -p "require('./package.json').version")"

# è‡ªå‹•ãƒªãƒªãƒ¼ã‚¹: ãƒ¡ã‚¸ãƒ£ãƒ¼ (1.0.0 â†’ 2.0.0)
release-major:
	@echo "ğŸš€ Starting automated major release..."
	@echo ""
	@echo "Step 1/5: Running validation..."
	npm run validate
	@echo ""
	@echo "Step 2/5: Bumping major version..."
	npm version major
	@echo ""
	@echo "Step 3/5: Building package..."
	npm run build
	@echo ""
	@echo "Step 4/5: Committing dist files..."
	git add dist/
	git diff --staged --quiet || git commit -m "build: update dist files for $$(node -p "require('./package.json').version")"
	@echo ""
	@echo "Step 5/5: Pushing to GitHub..."
	git push --follow-tags
	@echo ""
	@echo "âœ… Release complete! GitHub Actions will create the release."
	@echo "Version: $$(node -p "require('./package.json').version")"
